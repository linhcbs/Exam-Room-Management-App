
    <!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../../../server/database/images/favicon.ico?v=1" type="image/x-icon">
    <title>SƠ ĐỒ CHỖ NGỒI</title>
    <style>
    * {
    transition-duration: 0.5s;
}

body {
    font-family: 'Times New Roman', Times, serif;
    display: flex;
    align-items: center;
    padding: 0vw 5vw;
    overflow-x: hidden;
}

#main-form {
    display: flex;
    font-weight: bold;
    justify-content: center;
    margin: auto;
}


.display-id {
    width: 5vw;
    font-size: 1.10vw;
    text-align: center;
    border: 1px solid black;
    padding: 0px;
    cursor: pointer;
}

img {
    height: 5vw;
    width: 4vw;
    font-weight: lighter;
    font-size: 1vw;
}

caption {
    font-family: inherit;
    text-align: center;
    font-weight: bold;
    font-size: 1vw;
}

table {
    font-weight: bold;
    font-size: 2vw;
    border-spacing: 3.5vw 0.10vw;
    margin: auto;
}

th {
    text-transform: uppercase;
}

#time-section {
    width: 25vw;
    display: flex;
    height: 3vw;
    margin: 0.5vw;
    padding: 0px;
}

#start,
#progress-bar,
#end {
    border: 1px solid black;
    height: 100%;
}

#start,
#end {
    width: 10%;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0vw 0.5vw;
}

#progress-bar {
    width: 80%;
}

#progress {
    height: 100%;
    width: 0%;
    background-color: rgb(0, 153, 255);
    transition: width 2s linear 1s;
}


#real-time {
    height: 2vw;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0px;
    padding: 0px;
}
    </style>

<body>
    <div id="main-form">
        <div style="display: flex;">
            <div>
                <div
                    style="display: flex; flex-direction: column; justify-content: center; align-items: center; line-height: 2vw; margin-bottom: 1vw;">
                    <span>ỦY BAN NHÂN DÂN QUẬN X</span>
                    <span>TRƯỜNG THCS 1</span>
                </div>
                <div style="display: flex; flex-direction: column; justify-content: center; align-items: center;">
                    <span>THI 1</span>
                    <span>KHỐI: 1</span>
                    <span style="margin: 0.75vw;">MÔN: 1</span>
                    <span style="text-align: center;">NGÀY 19 THÁNG 12 NĂM 2024 <br> THỜI GIAN: 12 PHÚT</span>
                </div>
                <div>
                    <h1 id="time-runout" style="text-align: center; color: crimson; display: none;">! HẾT GIỜ LÀM BÀI!
                    </h1>
                </div>
                <div>
                    <div id="real-time">
                    </div>
                    <div>
                        <div id="time-section" class="time">
                            <div id="start" class="time"></div>
                            <div id="progress-bar" class="time">
                                <div id="progress"></div>
                            </div>
                            <div id="end" class="time"></div>
                        </div>
                        <span>Thí sinh vắng thi: </span><br>
                        <span style="margin-right: 1vw;">SBD</span>
                        <span>Họ và tên</span>
                        <div id="absent">
                        </div>
                    </div>
                </div>
            </div>
            <div style ="margin-left: 7vw;">
                <div style="display: block;">
                    <hr>
                    <div id="room-list">
                        
        <hr>
        <table id="room_1">
            <caption style="text-align: center; font-size: 1.5vw; width:100%;">PHÒNG 1 SƠ ĐỒ CHỖ NGỒI THÍ SINH</caption>
        
            <tbody><tr id="room-1-row-1"><td class="display-id" id="room-1-cell-1">A012<img src="../../../server/database/photos/A012.jpg" alt="A012"></td><td class="display-id" id="room-1-cell-2">A009<img src="../../../server/database/photos/A009.jpg" alt="A009"></td><td class="display-id" id="room-1-cell-3">A024<img src="../../../server/database/photos/A024.jpg" alt="A024"></td><td class="display-id" id="room-1-cell-4">A021<img src="../../../server/database/photos/A021.jpg" alt="A021"></td></tr>
            </tbody>
            <tbody><tr id="room-1-row-2"><td class="display-id" id="room-1-cell-5">A011<img src="../../../server/database/photos/A011.jpg" alt="A011"></td><td class="display-id" id="room-1-cell-6">A010<img src="../../../server/database/photos/A010.jpg" alt="A010"></td><td class="display-id" id="room-1-cell-7">A023<img src="../../../server/database/photos/A023.jpg" alt="A023"></td><td class="display-id" id="room-1-cell-8">A022<img src="../../../server/database/photos/A022.jpg" alt="A022"></td></tr>
            </tbody>
            <tbody><tr id="room-1-row-3"><td class="display-id" id="room-1-cell-9">A008<img src="../../../server/database/photos/A008.jpg" alt="A008"></td><td class="display-id" id="room-1-cell-10">A005<img src="../../../server/database/photos/A005.jpg" alt="A005"></td><td class="display-id" id="room-1-cell-11">A020<img src="../../../server/database/photos/A020.jpg" alt="A020"></td><td class="display-id" id="room-1-cell-12">A017<img src="../../../server/database/photos/A017.jpg" alt="A017"></td></tr>
            </tbody>
            <tbody><tr id="room-1-row-4"><td class="display-id" id="room-1-cell-13">A007<img src="../../../server/database/photos/A007.jpg" alt="A007"></td><td class="display-id" id="room-1-cell-14">A006<img src="../../../server/database/photos/A006.jpg" alt="A006"></td><td class="display-id" id="room-1-cell-15">A019<img src="../../../server/database/photos/A019.jpg" alt="A019"></td><td class="display-id" id="room-1-cell-16">A018<img src="../../../server/database/photos/A018.jpg" alt="A018"></td></tr>
            </tbody>
            <tbody><tr id="room-1-row-5"><td class="display-id" id="room-1-cell-17">A004<img src="../../../server/database/photos/A004.jpg" alt="A004"></td><td class="display-id" id="room-1-cell-18">A001<img src="../../../server/database/photos/A001.jpg" alt="A001"></td><td class="display-id" id="room-1-cell-19">A016<img src="../../../server/database/photos/A016.jpg" alt="A016"></td><td class="display-id" id="room-1-cell-20">A013<img src="../../../server/database/photos/A013.jpg" alt="A013"></td></tr>
            </tbody>
            <tbody><tr id="room-1-row-6"><td class="display-id" id="room-1-cell-21">A003<img src="../../../server/database/photos/A003.jpg" alt="A003"></td><td class="display-id" id="room-1-cell-22">A002<img src="../../../server/database/photos/A002.jpg" alt="A002"></td><td class="display-id" id="room-1-cell-23">A015<img src="../../../server/database/photos/A015.jpg" alt="A015"></td><td class="display-id" id="room-1-cell-24">A014<img src="../../../server/database/photos/A014.jpg" alt="A014"></td></tr>
            </tbody></table>
        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="module">
        let absents = {

        }
        const timeline = {"call-in-time-hour":"12","call-in-time-minute":"35","distribute-time-hour":"12","distribute-time-minute":"40","near-end-time":"5 phút"}
        const names = {"A000":"Pham Duc Bao","A001":"Bui Van Bao","A002":"Nguyen Mai Quyen","A003":"Do Thi Khanh","A004":"Pham Ngoc Khanh","A005":"Pham Quoc An","A006":"Vu Thanh Bao","A007":"Pham Mai Chau","A008":"Bui Huu Giang","A009":"Nguyen Hong Dung","A010":"Do Hong Quyen","A011":"Pham Duc Linh","A012":"Bui Hong Dung","A013":"Le Minh Chau","A014":"Hoang Mai Quyen","A015":"Hoang Thanh Bao","A016":"Vu Thi An","A017":"Vo Duc Khanh","A018":"Dang Hong Khanh","A019":"Bui Quoc Bao","A020":"Bui Hong Linh","A021":"Hoang Ngoc An","A022":"Pham Ngoc Quyen","A023":"Pham Hong Giang","A024":"Vu Thi An","A025":"Nguyen Hong Dung","A026":"Nguyen Ngoc Chau","A027":"Do Mai Dung","A028":"Dang Van My","A029":"Hoang Hong Dung","A030":"Tran Duc An","A031":"Vu Huu My","A032":"Pham Van Bao","A033":"Tran Huu Khanh","A034":"Vu Minh My","A035":"Pham Van Giang","A036":"Pham Ngoc Bao","A037":"Vo Mai Quyen","A038":"Hoang Ngoc An","A039":"Vo Van Dung","A040":"Vo Thanh Quyen","A041":"Bui Hong Bao","A042":"Nguyen Thanh Giang","A043":"Tran Duc An","A044":"Bui Thi Dung","A045":"Dang Van An","A046":"Hoang Duc Quyen","A047":"Hoang Huu Chau","A048":"Bui Ngoc Hien","A049":"Nguyen Van Khanh","A050":"Vo Thi Quyen","A051":"Hoang Hong Giang","A052":"Nguyen Ngoc Khanh","A053":"Hoang Thanh Hien","A054":"Pham Huu Quyen","A055":"Hoang Mai An","A056":"Bui Huu Quyen","A057":"Pham Duc Khanh","A058":"Nguyen Mai Hien","A059":"Hoang Quoc Quyen","A060":"Nguyen Duc An","A061":"Vu Quoc Dung","A062":"Pham Thanh Dung","A063":"Do Minh Bao","A064":"Nguyen Thi Hien","A065":"Hoang Thanh Dung","A066":"Pham Thanh Linh","A067":"Vu Huu Chau","A068":"Dang Minh Giang","A069":"Dang Huu My","A070":"Bui Thanh Bao","A071":"Vu Hong Linh","A072":"Hoang Duc Giang","A073":"Pham Thi Khanh","A074":"Vu Ngoc My","A075":"Tran Minh Dung","A076":"Hoang Hong Chau","A077":"Le Huu My","A078":"Le Thanh Hien","A079":"Tran Quoc Chau","A080":"Le Thanh Quyen","A081":"Bui Huu Linh","A082":"Vo Hong Giang","A083":"Nguyen Thi Hien","A084":"Pham Thi Hien","A085":"Tran Minh Giang","A086":"Vo Van Khanh","A087":"Vo Ngoc Dung","A088":"Bui Mai Giang","A089":"Bui Van My","A090":"Pham Duc Hien","A091":"Pham Hong Khanh","A092":"Le Hong Hien","A093":"Do Quoc Chau","A094":"Pham Duc Dung","A095":"Dang Mai My","A096":"Pham Duc Chau","A097":"Hoang Minh Giang","A098":"Bui Hong Khanh","A099":"Nguyen Hong Quyen"}
        let called = [0, 0, 0]
        let minBeforeStart = 5, runned = 0;
        let beginRunned = 0;
        let zone = 0, soundPath = "";
            if (timeline["near-end-time"] == "5 phút") {
                zone = 5;
                soundPath = "../../../server/database/sounds/near-end-5.mp3"
            }
            if (timeline["near-end-time"] == "15 phút") {
                zone = 15;
                soundPath = "../../../server/database/sounds/near-end-15.mp3"
            }
            if (timeline["near-end-time"] == "30 phút") {
                zone = 30;
                soundPath = "../../../server/database/sounds/near-end-30.mp3"
            }
        function formatTime(hour, min) {
            if (min < 10) return hour + ":0" + min;
            else return hour + ":" + min;
        }

        function announce(path) {
            let audio = new Audio(path);
            audio.play();
        }

        // man im ded
        function timeValue(h, m) {
            return h * 60 * 60 + m * 60;
        }

        function blastNearEnd(tn, te){
            if ((te - tn) <= zone*60){
                announce(soundPath)
                return 1;
            }
            return 0;
        }

        function getDiff(start_hour, start_min, end_hour, end_min, h, m, s) {
            let ts = timeValue(start_hour, start_min);
            let te = timeValue(end_hour, end_min);
            let tn = timeValue(h, m) + s;
            let call_in = timeValue(Number(timeline["call-in-time-hour"]), Number(timeline["call-in-time-minute"]))
            let distribute = timeValue(Number(timeline["distribute-time-hour"]), Number(timeline["distribute-time-minute"]))

            if (tn > call_in && called[0] == 0){
                announce("../../../server/database/sounds/call-in.mp3")
                called[0]++;
            }
            if (tn > distribute && called[1] == 0){
                announce("../../../server/database/sounds/distribute the papers.mp3")
                called[1]++;
            }
            if (called[2] == 0){
                called[2] += blastNearEnd(tn, te);
            }
            if (tn > ts && beginRunned == 0) {
                announce("../../../server/database/sounds/begin.mp3")
                document.getElementById("room-list").style.display = "none";
                beginRunned++;
            }
            else if (tn >= te) {
                return 1;
            }
            else {
                // console.log((tn-ts)/(te-ts)*1.0)
                return ((tn - ts) / (te - ts)) * 1.0;
            }
        }


        function startClock(start_hour, start_min, end_hour, end_min) {
            var element = document.getElementById("progress-bar");
            var width = 1;
            var identity = setInterval(scene, 500);
            function scene() {
                if (width >= 100) {
                    width = 100;
                    clearInterval(identity);
                    element.innerHTML = '<div id="progress" style="width: ' + 100 + '%;"></div>'
                    announce("../../../server/database/sounds/announcement (end).mp3")
                    document.getElementById("time-runout").style.display = "block"
                } else {
                    const today = new Date();
                    let h = today.getHours();
                    let m = today.getMinutes();
                    let s = today.getSeconds();
                    width = getDiff(start_hour, start_min, end_hour, end_min, h, m, s) * 100;
                    element.innerHTML = '<div id="progress" style="width: ' + width + '%;"></div>'
                }
            }
        }

        function writeTime(start_hour, start_min, end_hour, end_min) {
            document.getElementById("start").innerHTML = formatTime(start_hour, start_min);
            document.getElementById("end").innerHTML = formatTime(end_hour, end_min);

            startClock(start_hour, start_min, end_hour, end_min)
        }

        function check(i) {
            if (i < 10) return '0' + i;
            return i;
        }

        function startPermanentClock() {
            let id = setInterval(scene, 800);
            function scene() {
                const today = new Date();
                let h = today.getHours();
                let m = today.getMinutes();
                let s = today.getSeconds();
                document.getElementById("real-time").innerHTML = check(h) + ':' + check(m) + ':' + check(s);
            }
            console.log("hi")
        }
        function renderAbsents() {
            document.getElementById("absent").innerHTML = ""
            for (let id in absents){
                document.getElementById("absent").innerHTML +=  "<span>" +id+ ": " + absents[id]+" </span> <br>"
            }
        }

        startPermanentClock()
        writeTime(12, 45, 12, 50)

        let ids = {};
        let activate = {};

        let rooms = document.getElementsByTagName("table").length;
        for (let room = 1; room <= rooms; room++) {
            ids["room_" + room] = [];
            activate["room_" + room] = [false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false,];
            for (let i = 0; i < 24; i++) {
                ids["room_" + room].push(document.getElementById("room-" + room + "-cell-" + (i + 1)).textContent)
            }
        }

        for (let room = 1; room <= rooms; room++) {
            for (let i = 0; i < 24; i++) {
                let cell = document.getElementById("room-" + room + "-cell-" + (i + 1))
                cell.addEventListener("click", (e) => {
                    let obj;
                    if (e.target.tagName != "TD") obj = e.target.parentNode;
                    else obj = e.target;

                    let dis = activate["room_" + room][i];
                    if (activate["room_" + room][i] == false) activate["room_" + room][i] = true;
                    else if (activate["room_" + room][i] == true) activate["room_" + room][i] = false;

                    if (dis == false && ids["room_" + room][i] != "") {
                        obj.innerHTML = ids["room_" + room][i] + '<p> vắng <br> ' + names[ids["room_" + room][i]] + '</p>'
                        absents[ids["room_" + room][i]] = names[ids["room_" + room][i]];
                    }
                    else if (dis == true && ids["room_" + room][i] != "") {
                        obj.innerHTML = ids["room_" + room][i] + '<img src="../../../server/database/photos/' + ids["room_" + room][i] + '.jpg" alt="">'
                        delete absents[ids["room_" + room][i]]
                    }
                    renderAbsents();
                })
            }
        }

        const creds = ""
    </script>
</body>

</html>
    